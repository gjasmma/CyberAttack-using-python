// plugins/malware.js
const psTree = require("ps-tree"); // optional cross-platform process tree

module.exports = {
  id: "malware-scan",
  name: "Malware Scan",
  icon: "ðŸ¦ ",
  description: "Scan running processes for suspicious names (demo).",
  run: async () => {
    // Minimal process name check â€” simulation
    const suspiciousPatterns = ["hack", "virus", "malware", "keylogger"];
    const { exec } = require("child_process");

    // Cross-platform list: fall back to basic commands
    const cmd =
      process.platform === "win32"
        ? "wmic process get ProcessId,Name"
        : "ps -eo pid,comm";
    const output = await new Promise((resolve, reject) => {
      exec(cmd, (err, stdout) => (err ? reject(err) : resolve(stdout)));
    });

    const lines = output.split("\n").slice(1);
    const matches = [];
    for (const line of lines) {
      const cleaned = line.trim();
      if (!cleaned) continue;
      const parts = cleaned.split(/\s+/);
      const pid = parts[0];
      const name = parts.slice(1).join(" ").toLowerCase();
      if (suspiciousPatterns.some((p) => name.includes(p))) {
        matches.push({ pid, name });
      }
    }
    return { status: matches.length ? "suspicious" : "clean", matches };
  },
};
